@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Xsrf
@functions {
    public string GetAntiXsrfRequestToken()
    {
        return Xsrf.GetAndStoreTokens(Context).RequestToken;
    }
}
@model AppUserAddDto

@{
    Layout = null;
}
<link href="~/files/assets/pages/advance-elements/css/bootstrap-datetimepicker.css" />
<link rel="stylesheet" type="text/css" href="~/files/lib/jquery-easyui-1.10.4/themes/bootstrap/easyui.css">

<div class="row">
    <div class="col-lg-12 col-xl-12">
        <!-- Nav tabs -->
        <ul class="nav nav-tabs mb-3 tabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" data-toggle="tab"
                   href="#home3" role="tab">Müqavilə  </a>
            </li>
            <li class="nav-item">
                <a class="nav-link " data-toggle="tab"
                   href="#home1" role="tab">Şəxsi Məlumatlar</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab"
                   href="#home2" role="tab">ŞV</a>
            </li>

            <li class="nav-item">
                <a class="nav-link" data-toggle="tab"
                   href="#home4" role="tab">Əmək fəaliyyəti</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab"
                   href="#profile1" role="tab">Fayllar</a>
            </li>

            <li class="nav-item">
                <a class="nav-link" data-toggle="tab"
                   href="#vacationRemain" role="tab">Məzuniyyət qalıqları</a>
            </li>

        </ul>
        <!-- Tab panes -->
        <form asp-action="Add" class="main-signin-form" enctype="multipart/form-data">
            <div class="tab-content tabs">
                <div class="tab-pane " id="home1" role="tabpanel">


                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel">  Ad: </label>
                                <input type="text" class="form-control" asp-for="Name" autocomplete="off">
                                <span asp-validation-for="Name" class="text-danger"></span>
                                <span class="messages"></span>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel">  Soyad: </label>
                                <input type="text" class="form-control" asp-for="Surname" autocomplete="off">
                                <span asp-validation-for="Surname" class="text-danger"></span>
                                <span class="messages"></span>
                            </div>

                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel">  Ata adı: </label>
                                <input type="text" class="form-control" asp-for="Fathername" autocomplete="off">

                            </div>
                        </div>
                        <div class="col-sm-6">
                            <label class="floatLabel">  Doğum Tarixi: </label>
                            <div class="form-group">
                                <input asp-for="Birthday" type="text" maxlength="10" class="form-control custom-date">
                                @*<a href="#" id="buttonid" style="position: absolute;top: 7px;right: 25px;" class="ion-close-round">x</a>*@
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel">  SSN kod: </label>
                                <input type="text" maxlength="13" class="form-control" asp-for="SsnCode" autocomplete="off">

                            </div>

                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel">  Cinsi: </label>
                                <div class="form-group main-custom-border">
                                    <div class="form-radio">
                                        <div class="radio radio-inline">
                                            <label for="FEMALE">
                                                <input type="radio" id="FEMALE" value="FEMALE" asp-for="Gender"
                                                       checked="checked">
                                                <i class="helper"></i>Qadın
                                            </label>
                                        </div>
                                        <div class="radio radio-inline">
                                            <label for="MALE">
                                                <input type="radio" id="MALE" value="MALE" asp-for="Gender">
                                                <i class="helper"></i>Kişi
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel">  Email: </label>
                                <input type="email" class="form-control" asp-for="Email" autocomplete="off">
                                <span asp-validation-for="Email" class="text-danger"></span>
                                <span class="messages"></span>
                            </div>

                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel">  Şifrə: </label>
                                <input type="password" class="form-control" asp-for="Password" autocomplete="off">
                                <span asp-validation-for="Password" class="text-danger"></span>
                                <span class="messages"></span>
                            </div>

                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel"> Qeydiyyat Ünvanı: </label>
                                <input type="text" class="form-control" asp-for="RegisterAdress" autocomplete="off">
                                <span asp-validation-for="RegisterAdress" class="text-danger"></span>
                                <span class="messages"></span>
                            </div>

                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel"> Yaşadığı Ünvanı: </label>
                                <input type="text" class="form-control" asp-for="Address" autocomplete="off">
                                <span class="messages"></span>
                            </div>

                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel"> Ev nömrə: </label>
                                <input type="text" placeholder="+994 __-___-__-__" class="form-control" asp-for="HomePhoneNumber" autocomplete="off">
                                <span class="messages"></span>
                            </div>
                        </div>  
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel"> Şəxsi nömrə: </label>
                                <input type="text" placeholder="+994 __-___-__-__" class="form-control" asp-for="PersonalPhoneNumber" autocomplete="off">
                                <span class="messages"></span>
                            </div>
                        </div>
                    </div> 
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel"> Korporativ nömrə: </label>
                                <input type="text" placeholder="+994 __-___-__-__" class="form-control" asp-for="PhoneNumber" autocomplete="off">
                                <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                                <span class="messages"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane" id="home2" role="tabpanel">
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel">  Vəsiqənin Seriyası və Nömrəsi: </label>
                                <input type="text" class="form-control" asp-for="IdCardNumber" autocomplete="off">
                                <span asp-validation-for="IdCardNumber" class="text-danger"></span>
                                <span class="messages"></span>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel">  Vəsiqənin Verilmə Tarixi: </label>
                                <input type="text" maxlength="10" class="form-control custom-date" asp-for="IdCardGiveDate" autocomplete="off">
                                <span asp-validation-for="IdCardGiveDate" class="text-danger"></span>
                                <span class="messages"></span>
                            </div>

                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel">  Sənəd növü: </label>
                                <select name="select" asp-for="IdCardType" name="IdCardType" class="form-control">
                                    <option value="" disabled selected hidden>Seçim edin</option>
                                    @foreach (var item in ViewBag.idCardTypes)
                                    {
                                        <option value="@item.Id">@item.Name</option>
                                    }

                                </select>
                                <span asp-validation-for="IdCardType" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel"> Vətəndaşlıq: </label>
                                <input type="text" class="form-control" asp-for="Citizenship" value="Azərbaycan" autocomplete="off">
                                <span class="messages"></span>
                            </div>

                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel">  Vəsiqənin Qüvvədə Olma Tarixi: </label>
                                <input type="text" maxlength="10" class="form-control custom-date" asp-for="IdCardExpireDate" autocomplete="off">
                                @*<span asp-validation-for="IdCardExpireDate" class="text-danger"></span>*@
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel">  Vəsiqəni Verən Orqanın Adı: </label>
                                <input type="text" class="form-control" asp-for="IdCardGivePlace" autocomplete="off">
                                <span asp-validation-for="IdCardGivePlace" class="text-danger"></span>
                                <span class="messages"></span>
                            </div>

                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel"> Fin kod: </label>
                                <input type="text" class="form-control" asp-for="Pin" autocomplete="off">
                                <span asp-validation-for="Pin" class="text-danger"></span>
                                <span class="messages"></span>
                            </div>

                        </div>
                    </div>
                </div>


                <div class="tab-pane active" id="home3" role="tabpanel">
                    <div class="row">

                        <div class="col-sm-6">
                            <label class="floatLabel">  İşə Başlama Tarixi: </label>
                            <div class="form-group">
                                <input asp-for="StartWorkDate" type="text" maxlength="10" class="form-control custom-date">
                                <span asp-validation-for="StartWorkDate" class="text-danger"></span>
                                @*<a href="#" id="buttonid" style="position: absolute;top: 7px;right: 25px;" class="ion-close-round">x</a>*@
                            </div>
                        </div>

                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel">  Əmək Haqqı: </label>
                                <input type="text" asp-for="Salary" placeholder="0,00" class="form-control autonumber" data-a-sep="" data-a-dec=",">
                                <span asp-validation-for="Salary" class="text-danger"></span>
                            </div>

                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <label class="floatLabel">   Şirkət: </label>
                            <div style="margin-bottom:20px">
                                <input type="text" class="form-control" asp-for="CompanyId" style="width:100%">
                                <span class="CompanyId text-danger"></span>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <label class="floatLabel">  Şöbə: </label>
                            <div style="margin-bottom:20px">
                                <input type="text" class="form-control" asp-for="DepartmentId" name="DepartmentId" style="width:100%">
                                <span class="DepartmentId text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-6">
                            <label class="floatLabel">   Vəzifə: </label>
                            <div style="margin-bottom:20px">
                                <input type="text" class="form-control" asp-for="PositionId" name="PositionId" style="width:100%">
                                <span class="PositionId text-danger"></span>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel">  Dərəcə: </label>
                                <select name="select" asp-for="GradeId" name="GradeId" class="form-control">
                                    <option value="" disabled selected hidden>Seçim edin</option>
                                    @foreach (var item in ViewBag.grades)
                                    {
                                        <option value="@item.Id">@item.GradeName</option>
                                    }

                                </select>
                                <span asp-validation-for="GradeId" class="text-danger"></span>
                            </div>
                        </div>

                    </div>

                    <div class="row">

                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel"> Məzuniyyət Əsas Gün Sayı: </label>
                                <input type="number" value="0" class="form-control" asp-for="VacationMainDay" autocomplete="off">
                                <span asp-validation-for="VacationMainDay" class="text-danger"></span>
                                <span class="messages"></span>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel"> Bitirdiyi Təhsil Müəssisəsinin adı: </label>
                                <input type="text" class="form-control" asp-for="GraduatedPlace" autocomplete="off">
                                <span class="messages"></span>
                            </div>

                        </div>

                    </div>

                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel"> Məzuniyyət Əmək Stajına görə: </label>
                                <input type="number" value="0" class="form-control" asp-for="VacationExtraExperience" autocomplete="off">

                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel"> Bitirdiyi İxtisasın adı: </label>
                                <input type="text" class="form-control" asp-for="Profession" autocomplete="off">
                                <span class="messages"></span>
                            </div>

                        </div>


                    </div>

                    <div class="row">

                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel"> Məzuniyyət Əmək Şəraitinin Xarakterinə görə: </label>
                                <input type="number" value="0" class="form-control" asp-for="VacationExtraNature" autocomplete="off">

                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel">  Təhsilin növü: </label>
                                <select name="select" asp-for="EducationLevel" name="EducationLevel" class="form-control">
                                    <option value="" disabled selected hidden>Seçim edin</option>
                                    @foreach (var item in ViewBag.educationLevels)
                                    {
                                        <option value="@item.Id">@item.Name</option>
                                    }

                                </select>
                                <span asp-validation-for="EducationLevel" class="text-danger"></span>
                            </div>
                        </div>


                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floatLabel"> Məzuniyyət 14 Yaş. İki. Çox Uşağı..: </label>
                                <input type="number" value="0" class="form-control" asp-for="VacationExtraChild" autocomplete="off">

                            </div>
                        </div>
                        <div class="col-sm-6" id="graphic_div">
                            <label class="floatLabel">  İş qrafiki: </label>
                            <select asp-for="WorkGraphicId" class="form-control">
                                <option value="" disabled selected hidden>Seçim edin</option>
                                @foreach (var item in ViewBag.workGraphics)
                                {
                                    <option value="@item.Id">@item.Name</option>
                                }
                            </select>
                            <span asp-validation-for="WorkGraphicId" class="text-danger"></span>
                        </div>


                    </div>
                </div>


                <div class="tab-pane" id="home4" role="tabpanel">
                    <input class="rowCount" type="hidden" value="0" />
                    <div id="row-box">
                    </div>
                    <div class="row">
                        @*                        <div class="col-6 text-left">
                        Ümumi staj <p class="text-primary">0</p>
                        </div>*@
                        <div class="col-12 text-right">
                            İş stajı: <button type="button" id="addRow" class="btn btn-outline-success " data-bs-toggle="tooltip" data-bs-placement="top" title="İş stajı"><i class="icofont icofont-plus m-0"></i></button>
                        </div>
                    </div>
                    @* @for (var i = 0; i < 1; i++)
                    {
                    <div class="row"> <div class="col-sm-6"> <div class="form-group"> <label class="floatLabel"> Yer: </label> <input type="text" class="form-control" asp-for="UserExperiences[i].Place" autocomplete="off"> <span class="messages"></span> </div> </div><div class="col-sm-6"> <div class="form-group"> <label class="floatLabel"> Tarix: </label> <div class="input-group input-daterange mb-0"> <input type="text" asp-for="UserExperiences[i].ExperienceStart" class="form-control" autocomplete="off"> <div class="input-group-addon">to</div> <input type="text" asp-for="UserExperiences[i].ExperienceEnd" class="form-control" autocomplete="off"> </div> <span asp-validation-for="UserExperiences[0].ExperienceStart" class="text-danger"></span> <span asp-validation-for="UserExperiences[0].ExperienceEnd" class="text-danger"></span> <span class="messages"></span> </div> </div> </div>
                    }*@
                </div>


                <div class="tab-pane" id="profile1" role="tabpanel">
                    <div class="form-group">
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="file-name file upload btn btn-outline-primary btn-round mb-4" style="position: relative;overflow: hidden;">
                                            Şəkil Yüklə
                                            <input type="file" name="profile" id="Profile" style="position: absolute;font-size: 50px;opacity: 0;right: 0;top: 0;" />
                                        </div>
                                    </div>
                                    <div class="col-md-6  col-lg-6 col-sm-6">
                                        <div class="border text-center pt-2">
                                            <div class="pt-0">
                                                <label class="floatLabel">Mövcüd Şəkil:</label>
                                                <img src="~/uploads/default.png" class="pb-2" style="width: 150px; height: 150px;" alt="Default Avatar" />
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6 col-lg-6 col-sm-6">
                                        <div id="lview" style="display:none!important;">
                                            <div class="border text-center pt-2">
                                                <div class="pt-0">
                                                    <label class="floatLabel">Yeni Şəkil:</label>
                                                    <img id="logoview" src="" class="pb-2" style="width: 150px; height: 150px;" alt="" />
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane" id="vacationRemain" role="tabpanel">
                    <div class="form-group">

                        <div id="vac-box">
                            <input id="vacCount" type="hidden" value="0" />
                        </div>
                        <div class="row">
                            <div class="col-12 text-right">
                                Əlavə et: <button type="button" id="addVacDay" class="btn btn-outline-success " data-bs-toggle="tooltip" data-bs-placement="top" title="Məzuniyyət qalığı"><i class="icofont icofont-plus m-0"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group row mt-3">
                    <div class="col-sm-12 d-flex justify-content-between">
                        <button type="submit" id="sub-btn" class="btn btn-dark-blue m-b-0  btn-block">
                            Təsdiqlə
                        </button>

                    </div>
                </div>
            </div>
        </form>
    </div>

</div>
@await Html.PartialAsync("_ValidationScriptsPartial")
<!-- Mask js -->
<script type="text/javascript" src="~/files/lib/jquery.maskedinput/jquery.maskedinput.min.js"></script>
<!-- Masking js -->
<script src="~/files/assets/pages/form-masking/inputmask.js"></script>
<script src="~/files/assets/pages/form-masking/jquery.inputmask.js"></script>
<script src="~/files/assets/pages/form-masking/autoNumeric.js"></script>
<script src="~/files/assets/pages/form-masking/form-mask.js"></script>
<!-- cust-validation js -->
<script src="~/files/lib/cust_ajax/cust-validation.js"></script>
<script type="text/javascript" src="~/files/lib/jquery-easyui-1.10.4/jquery.easyui.min.js"></script>

<script>
    $.validator.setDefaults({ ignore: '' });
    $(document).ready(function () {

        $('#Salary').rules("remove", "number");

        let dateArray = [];

        $('.custom-date').each(function () {
            $(this).datepicker({
                format: "dd.mm.yyyy"
            })
        })

        $('#StartWorkDate').each(function () {
            $(this).datepicker({
                format: "dd.mm.yyyy"
            }).on('changeDate', function (ev) {
                $(this).change();
            });
            $(this).change(function () {
                getUserVacationDay();
            });
        })

        $("form").submit(function (e) {
            let isEmpty = false;
            $(".experience-history").each(function (i, el) {
                if (!$(el).val()) {
                    isEmpty = true;
                }
            });
            if (isEmpty) {
                toastr.error(" Staj tarixi boş ola bilməz !", "Xəta!");
                e.preventDefault();
            }
            if (!checkDate()) {
                e.preventDefault();
                return;
            }
            checkRemainCount(e);

            var CompanyId = $('#CompanyId').combotree('getValue');
            var DepartmentId = $('#DepartmentId').combotree('getValue');
            var PositionId = $('#PositionId').combotree('getValue');
            if (CompanyId.trim() === "") {
                $('.CompanyId').text($('#CompanyId').data("val-required")).removeClass("d-none");
                e.preventDefault();
            }
            if (DepartmentId.trim() === "") {
                $('.DepartmentId').text($('#DepartmentId').data("val-required")).removeClass("d-none");
                e.preventDefault();
            }
            if (PositionId.trim() === "") {
                $('.PositionId').text($('#PositionId').data("val-required")).removeClass("d-none");
                e.preventDefault();
            }
        });

        function setDisableAndOld() {
            dateArray = [];
            setDate('disable');
            setDate('old');
        }
        function removeDay() {
            $('.removeVacDay').click(function () {
                let rowCount = parseInt($("#vacCount").val());
                rowCount--;
                $("#vacCount").val(rowCount);
                $(this).parent().parent().remove();
            })
        }
        function removeExp() {
            $('.removeExp').click(function () {
                let rowCount = parseInt($(".rowCount").val());
                rowCount--;
                $(".rowCount").val(rowCount);
                $(this).parent().parent().remove();
                setNames();
            })
        }
        function checkRemainCount(e) {
            let isEmpty = false;
            $(".remain-count").each(function (i, el) {
                $(this).rules("remove", "number");
                let val = $(el).val();
                if (!val) {
                    isEmpty = true;
                }
            });
            if (isEmpty) {
                toastr.error(" Qalıq gün boş ola bilməz !", "Xəta!");
                e.preventDefault();
                return isEmpty;
            }
        }

        function setDate(type) {
            $(`.vacation-remain.${type}`).each(function (i, el) {
                let val = $(el).val();
                val = new Date(val);
                val.setHours(0, 0, 0, 0);
                let startMonth = val.getMonth() + 1;
                let startDay = val.getDate();
                let year = val.getFullYear();
                if (type == 'disable') {
                    val = new Date(year, startDay - 1, startMonth);
                }
                startMonth = val.getMonth() + 1;
                startDay = val.getDate();
                if (i % 2 == 0) {
                    dateArray.push(val);
                }
            })
        }

        function getUserVacationDay() {
            let elemets = document.getElementsByClassName('experience-history');
            let totalDays = 0;
            let startWorkDate = $('#StartWorkDate').val();
            startWorkDate = new Date(startWorkDate.split('.')[2], startWorkDate.split('.')[1] - 1, startWorkDate.split('.')[0]);
            //startWorkDate = new Date(startWorkDate);
            startWorkDate.setHours(0, 0, 0, 0);
            let nowDate = new Date();
            nowDate.setHours(0, 0, 0, 0);
            for (let index = 0; index < elemets.length / 2; index++) {
                let startEl = $(`.experienceStart-${index}`).val();
                let endEl = $(`.experienceEnd-${index}`).val();
                let dateStart = new Date(startEl.split('.')[2], startEl.split('.')[1] - 1, startEl.split('.')[0]);
                //let dateStart = new Date(startEl);
                let dateEnd = new Date(endEl.split('.')[2], endEl.split('.')[1] - 1, endEl.split('.')[0]);
                //let dateEnd = new Date(endEl);
                totalDays += Math.ceil((dateEnd.getTime() - dateStart.getTime()) / (1000 * 3600 * 24));
                //console.log(Math.ceil((dateEnd.getTime() - dateStart.getTime()) / (1000 * 3600 * 24)));
            }
            totalDays += Math.ceil((new Date().getTime() - startWorkDate.getTime()) / (1000 * 3600 * 24));
            let experienceYears = totalDays / 365;
            let vacationDay = 0;
            if (experienceYears >= 5 && experienceYears <= 10)
                vacationDay = 2;
            else if (experienceYears > 10 && experienceYears <= 15)
                vacationDay = 4;
            else if (experienceYears > 15)
                vacationDay = 6;
            $('#VacationExtraExperience').val(vacationDay);
        }

        function checkDate() {
            setDisableAndOld();
            let startYear;
            let valid = true;
            $(".vacation-remain").each(function (i, el) {
                let startWorkDate = $('#StartWorkDate').val();
                startWorkDate = new Date(startWorkDate.split('.')[2], startWorkDate.split('.')[1] - 1, startWorkDate.split('.')[0]);
                //startWorkDate = new Date(startWorkDate);
                startWorkDate.setHours(0, 0, 0, 0);
                let startWorkMonth = startWorkDate.getMonth() + 1;
                let startWorkDay = startWorkDate.getDate();
                let val = $(el).val();
                val = new Date(val.split('.')[2], val.split('.')[1] - 1, val.split('.')[0]);
                //val = new Date(val);
                val.setHours(0, 0, 0, 0);
                let startMonth = val.getMonth() + 1;
                let startDay = val.getDate();
                let year = val.getFullYear();
                if (el.classList.contains('disable')) {
                    val = new Date(year, startDay - 1, startMonth);
                    startMonth = val.getMonth() + 1;
                    startDay = val.getDate();
                }
                else if (el.classList.contains('new')) {
                    if (el.classList.contains('start') && startWorkDate > val) {
                        toastr.error(" Məzuniyyət qalığının başlama tarixi işə başlama tarixindən kiçik ola bilməz !", "Xəta!");
                        valid = false;
                        return valid;
                    }
                    if (i % 2 == 1) {
                        if (year - startYear != 1) {
                            toastr.error(" Aralıq 1 il olmalıdır !", "Xəta!");
                            valid = false;
                            return valid;
                        }
                    }
                    else {
                        startYear = year;
                    }
                    if (startMonth != startWorkMonth || startDay != startWorkDay) {
                        toastr.error(" Ay və gün işə başlama tarixindəki ilə eyni olmalıdı !", "Xəta!");
                        valid = false;
                        return valid;
                    }
                    if (valid && val && i % 2 == 0) {
                        if (dateArray.some(x => new Date(x).getTime() == new Date(val).getTime())) {
                            toastr.error(" Tarix artıq mövcuddur !", "Xəta!");
                            valid = false;
                            return valid;
                        }
                        else {
                            dateArray.push(val)
                        }
                    }
                }
            });
            return valid;
        }

        $( "#addRow").unbind().click(function (e) {
            let rowCount = parseInt($(".rowCount").val());
            rowCount++;
            $(".rowCount").val(rowCount);
            let html = `<div class="row">
                               <div class="col-sm-5">
                                   <div class="form-group">
                                       <label class="floatLabel"> Yer: </label>
                                       <input type="text" class="form-control user-experience-place" name="UserExperiences[${rowCount - 1}].Place" autocomplete="off">
                                   </div>
                               </div>
                               <div class="col-sm-5" >
                                   <div class="form-group">
                                       <label class="floatLabel"> Tarix: </label>
                                       <div class="input-group input-daterange mb-0">
                                           <input type="text" maxlength=10 name="UserExperiences[${rowCount - 1}].ExperienceStart" class="form-control user-experience-start experience-history experienceStart-${rowCount - 1}" autocomplete="off">
                                           <div class="input-group-addon">to</div>
                                           <input type="text" maxlength=10 name="UserExperiences[${rowCount - 1}].ExperienceEnd" class="form-control user-experience-end experience-history experienceEnd-${rowCount - 1}" autocomplete="off">
                                       </div>
                                   </div>
                               </div>
                               <div class="col-sm-2 text-right">
                                   Sil: <button type="button" class="btn btn-outline-danger removeExp" data-bs-toggle="tooltip" data-bs-placement="top" title="İş stajı"><i class="icofont icofont-close m-0"></i></button>
                               </div>
                           </div>`
            $('#row-box').append(html);

            $('.input-daterange').datepicker({
                format: "dd.mm.yyyy"
            }).on('changeDate', function (ev) {
                $('.input-daterange').change();
            });
            $('.input-daterange').change(function () {
                getUserVacationDay();
            });
            removeExp();
        });

        function setNames() {

            var seen = {};
            $('.user-experiences-old').each(function () {
                var name = $(this).attr('data-index');
                if (seen[name])
                    $(this).remove();
                else
                    seen[name] = true;
            });

            var countPlace = $('.user-experiences-old').length - 1;
            var countStart = $('.user-experiences-old').length - 1;;
            var countEnd = $('.user-experiences-old').length - 1;;

            $('.user-experience-place').each(function () {
                countPlace++;
                $(this).attr("name", `UserExperiences[${countPlace}].Place`)
            });

            $('.user-experience-start').each(function () {
                countStart++;
                $(this).attr("name", `UserExperiences[${countStart}].ExperienceStart`)
            })

            $('.user-experience-end').each(function () {
                countEnd++;
                $(this).attr("name", `UserExperiences[${countEnd}].ExperienceEnd`)
            })
        }
        //$(document).on("change", $(`input[name*='UserExperiences[${rowCount - 1}].ExperienceEnd']`), function () {
        //    let row = parseInt($(".rowCount").val());
        //    var start_date = "" + $(`input[name*='UserExperiences[${row - 1}].ExperienceStart']`).val();
        //    var end_date = "" + $(`input[name*='UserExperiences[${row - 1}].ExperienceEnd']`).val();
        //    var new_start_date = start_date.toString().split(".");
        //    var new_end_date = end_date.toString().split('.');
        //    a = calcDate(new Date(new_end_date[2], new_end_date[1]-1, new_end_date[0]), new Date(new_start_date[2], new_start_date[1]-1, new_start_date[0]))
        //    console.log(a)
        //});
        //function calcDate(date1, date2) {
        //    var diff = Math.floor(date1.getTime() - date2.getTime());
        //    var day = 1000 * 60 * 60 * 24;

        //    var days = Math.floor(diff / day);
        //    var months = Math.floor(days / 31);
        //    var years = Math.floor(months / 12);

        //    var message = date2.toDateString();
        //    message += " was "
        //    message += days + " days "
        //    message += months + " months "
        //    message += years + " years ago \n"

        //    return message
        //}
        $("#addVacDay").click(function (e) {
            if (!checkDate() || checkRemainCount(e)) {
                return;
            }
            let rowCount = parseInt($("#vacCount").val());
            rowCount++;
            $("#vacCount").val(rowCount);
            let html = `<div class="row">
                            <div class="col-sm-5" >
                                    <div class="form-group">
                                        <label class="floatLabel"> Tarix: </label>
                                        <div class="input-group input-daterange mb-0">
                                            <input type="text" maxlength=10 name="UserVacationRemains[${rowCount - 1}].FromDate" class="form-control vacation-remain start new" autocomplete="off">
                                            <div class="input-group-addon">to</div>
                                            <input type="text" maxlength=10 name="UserVacationRemains[${rowCount - 1}].ToDate" class="form-control vacation-remain end new" autocomplete="off">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-5">
                                    <div class="form-group">
                                        <label class="floatLabel"> Qalıq gün: </label>
                                        <input type="number" class="form-control remain-count" name="UserVacationRemains[${rowCount - 1}].RemainCount" autocomplete="off">
                                    </div>
                                </div>
                                 <div class="col-sm-2 text-right">
                                     Sil: <button type="button" class="btn btn-outline-danger  removeVacDay" data-bs-toggle="tooltip" data-bs-placement="top" title="Məzuniyyət qalığı"><i class="icofont icofont-close m-0"></i></button>
                                </div>
                            </div>`
            $('#vac-box').append(html);

            $('.input-daterange').datepicker({
                format: "dd.mm.yyyy"
            });
            removeDay()
        });


        $("#Profile").change(function (e) {
            if ($('.file-name').isImage()) {
                $("#lview").show();
                $("#logoview").attr('src', URL.createObjectURL(e.target.files[0]));
            }
            else {
                toastr.error("Diqqət", "Daxil edilən fayllar image, png və ya gif formatında olmalıdır !");
            }
        });

        $('#file-upload').change(function () {

            var file = $('#file-upload')[0].files[0].name;

            $('#uploaded').removeClass("d-none").text(file);

        });

        //phone number masking
        $.mask.definitions['9'] = '';
        $.mask.definitions['_'] = '[0-9]';

        $("#PhoneNumber").on("focus", function () {
            $("#PhoneNumber").mask("+\994\ __-___-__-__", { clearMaskOnLostFocus: false, placeholder: "+994 __-___-__-__" });
        });        
        $("#HomePhoneNumber").on("focus", function () {
            $("#HomePhoneNumber").mask("+\994\ __-___-__-__", { clearMaskOnLostFocus: false, placeholder: "+994 __-___-__-__" });
        });        
        $("#PersonalPhoneNumber").on("focus", function () {
            $("#PersonalPhoneNumber").mask("+\994\ __-___-__-__", { clearMaskOnLostFocus: false, placeholder: "+994 __-___-__-__" });
        });

        $.ajax({
                url: `@Url.Action("GetCompanyTreeBySignInUser","Account")`,
                type: "Get",
                data: "",
                dataType: "json",
                cache: false,
                success: function (data) {
                    var tree = $('#DepartmentId').combotree({
                        prompt: 'Seçim edin'
                    });
                    tree.combotree('disable')
                    var tre = $('#PositionId').combotree({
                        prompt: 'Seçim edin'
                    });
                    tre.combotree('disable')

                    $('#CompanyId').combotree({
                        data: data,
                        prompt: 'Seçim edin',
                        onClick: function (node) {
                            $('.CompanyId').text($('#CompanyId').data("val-required")).addClass("d-none")
                            $.ajax({
                                url: `@Url.Action("GetDepartmentTree","Account")`,
                                type: "Get",
                                data: {
                                    companyId: node.id,
                                },
                                dataType: "json",
                                cache: false,
                                success: function (data) {
                                    if (data.length > 0) {
                                        var tre = $('#DepartmentId').combotree({
                                            data: data,
                                            prompt: 'Seçim edin'
                                        });

                                        var tree = $('#PositionId').combotree({
                                            prompt: 'Seçim edin'
                                        });
                                        tree.combotree('disable')
                                        $('#DepartmentId').combotree({
                                            data: data,
                                            prompt: 'Seçim edin',
                                            onClick: function (node) {
                                                $('.DepartmentId').text($('#DepartmentId').data("val-required")).addClass("d-none")
                                                $.ajax({
                                                    url: `@Url.Action("GetPositionTree","Account")`,
                                                    type: "Get",
                                                    data: {
                                                        departmentId: node.id,
                                                    },
                                                    dataType: "json",
                                                    cache: false,
                                                    success: function (data) {

                                                        if (data.length > 0) {
                                                            var tree = $('#PositionId').combotree({
                                                                data: data,
                                                                prompt: 'Seçim edin',
                                                                onClick: () => {
                                                                    $('.PositionId').text($('#PositionId').data("val-required")).addClass("d-none")
                                                                }
                                                            });
                                                            tree.combotree('enable')
                                                            $('#PositionId').combotree('setValue', '')
                                                        }
                                                        else {
                                                            var tre = $('#PositionId').combotree({
                                                                prompt: 'Yoxdur !',
                                                            });
                                                            tre.combotree('disable')
                                                            tre.combotree('setValue', '')
                                                        }
                                                    },
                                                    error: function (data) {
                                                        toastr.error("Gözlənilməz xəta baş verdi", "Xəta!");
                                                    }
                                                })
                                            }
                                        })
                                        tre.combotree('enable')
                                    }
                                    else {
                                        var tree = $('#DepartmentId').combotree({
                                            prompt: 'Yoxdur !',
                                        });
                                        tree.combotree('disable')
                                        tree.combotree('setValue', '')
                                        var tre = $('#PositionId').combotree({
                                            prompt: 'Yoxdur !',
                                        });
                                        tre.combotree('disable')
                                        tre.combotree('setValue', '')
                                    }
                                },
                                error: function (data) {
                                    toastr.error("Gözlənilməz xəta baş verdi", "Xəta!");
                                }
                            })
                        }
                    })


                },
                error: function (data) {
                    toastr.error("Gözlənilməz xəta baş verdi", "Xəta!");
                }
            });

    });


</script>